{"version":3,"sources":["vs/workbench/contrib/webview/electron-browser/webview-pre.js"],"names":["ipcRenderer","require","registerVscodeResourceScheme","hasRegistered","webFrame","registerURLSchemeAsPrivileged","secure","bypassCSP","allowServiceWorkers","supportFetchAPI","corsEnabled","loadTimeout","firstLoad","pendingMessages","isInDevelopmentMode","initData","initialScrollProgress","undefined","applyStyles","body","classList","remove","add","activeTheme","styles","variable","Object","keys","style","setProperty","getActiveFrame","document","getElementById","getPendingFrame","isHandlingScroll","addEventListener","on","_event","value","baseUrl","variables","target","contentDocument","contentWindow","focus","data","options","text","contents","newDocument","DOMParser","parseFromString","querySelectorAll","forEach","a","title","getAttribute","head","getElementsByTagName","length","baseElement","createElement","href","appendChild","allowScripts","defaultScript","textContent","state","JSON","stringify","prepend","defaultStyles","id","innerHTML","map","replace","join","defaultCssRules","getDefaultCss","frame","wasFirstLoad","setInitialScrollPosition","window","isNaN","scrollY","scroll","clientHeight","previousPendingFrame","setAttribute","removeChild","newFrame","cssText","open","e","sendToHost","key","keyCode","code","shiftKey","altKey","ctrlKey","metaKey","repeat","onbeforeunload","console","log","onLoad","oldActiveFrame","visibility","event","progress","currentTarget","requestAnimationFrame","postMessage","clearTimeout","setTimeout","this","view","node","tagName","toLowerCase","scrollTo","hash","indexOf","scrollTarget","substr","scrollIntoView","preventDefault","parentNode","write","documentElement","close","push","onFocus","onBlur","isFocused","hasFocus","setInterval","isCurrentlyFocused","trackFocus","onmessage","message","command","process","pid"],"mappings":"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","file":"webview-pre.js","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n// @ts-check\n(function () {\n\t'use strict';\n\n\t// @ts-ignore\n\tconst ipcRenderer = require('electron').ipcRenderer;\n\n\tconst registerVscodeResourceScheme = (function () {\n\t\tlet hasRegistered = false;\n\t\treturn () => {\n\t\t\tif (hasRegistered) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\thasRegistered = true;\n\n\t\t\t// @ts-ignore\n\t\t\trequire('electron').webFrame.registerURLSchemeAsPrivileged('vscode-resource', {\n\t\t\t\tsecure: true,\n\t\t\t\tbypassCSP: false,\n\t\t\t\tallowServiceWorkers: false,\n\t\t\t\tsupportFetchAPI: true,\n\t\t\t\tcorsEnabled: true\n\t\t\t});\n\t\t};\n\t}());\n\n\t/**\n\t * Use polling to track focus of main webview and iframes within the webview\n\t *\n\t * @param {Object} handlers\n\t * @param {() => void} handlers.onFocus\n\t * @param {() => void} handlers.onBlur\n\t */\n\tconst trackFocus = ({ onFocus, onBlur }) => {\n\t\tconst interval = 50;\n\t\tlet isFocused = document.hasFocus();\n\t\tsetInterval(() => {\n\t\t\tconst isCurrentlyFocused = document.hasFocus();\n\t\t\tif (isCurrentlyFocused === isFocused) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tisFocused = isCurrentlyFocused;\n\t\t\tif (isCurrentlyFocused) {\n\t\t\t\tonFocus();\n\t\t\t} else {\n\t\t\t\tonBlur();\n\t\t\t}\n\t\t}, interval);\n\t};\n\n\t// state\n\tlet firstLoad = true;\n\tlet loadTimeout;\n\tlet pendingMessages = [];\n\tlet isInDevelopmentMode = false;\n\n\tconst initData = {\n\t\tinitialScrollProgress: undefined\n\t};\n\n\t/**\n\t * @param {HTMLElement} body\n\t */\n\tconst applyStyles = (body) => {\n\t\tif (!body) {\n\t\t\treturn;\n\t\t}\n\n\t\tbody.classList.remove('vscode-light', 'vscode-dark', 'vscode-high-contrast');\n\t\tbody.classList.add(initData.activeTheme);\n\n\t\tif (initData.styles) {\n\t\t\tfor (const variable of Object.keys(initData.styles)) {\n\t\t\t\tbody.style.setProperty(`--${variable}`, initData.styles[variable]);\n\t\t\t}\n\t\t}\n\t};\n\n\tconst getActiveFrame = () => {\n\t\treturn /** @type {HTMLIFrameElement} */ (document.getElementById('active-frame'));\n\t};\n\n\tconst getPendingFrame = () => {\n\t\treturn /** @type {HTMLIFrameElement} */ (document.getElementById('pending-frame'));\n\t};\n\n\t/**\n\t * @param {MouseEvent} event\n\t */\n\tconst handleInnerClick = (event) => {\n\t\tif (!event || !event.view || !event.view.document) {\n\t\t\treturn;\n\t\t}\n\n\t\tlet baseElement = event.view.document.getElementsByTagName('base')[0];\n\t\t/** @type {any} */\n\t\tlet node = event.target;\n\t\twhile (node) {\n\t\t\tif (node.tagName && node.tagName.toLowerCase() === 'a' && node.href) {\n\t\t\t\tif (node.getAttribute('href') === '#') {\n\t\t\t\t\tevent.view.scrollTo(0, 0);\n\t\t\t\t} else if (node.hash && (node.getAttribute('href') === node.hash || (baseElement && node.href.indexOf(baseElement.href) >= 0))) {\n\t\t\t\t\tlet scrollTarget = event.view.document.getElementById(node.hash.substr(1, node.hash.length - 1));\n\t\t\t\t\tif (scrollTarget) {\n\t\t\t\t\t\tscrollTarget.scrollIntoView();\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tipcRenderer.sendToHost('did-click-link', node.href);\n\t\t\t\t}\n\t\t\t\tevent.preventDefault();\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tnode = node.parentNode;\n\t\t}\n\t};\n\n\t/**\n\t * @param {KeyboardEvent} e\n\t */\n\tconst handleInnerKeydown = (e) => {\n\t\tipcRenderer.sendToHost('did-keydown', {\n\t\t\tkey: e.key,\n\t\t\tkeyCode: e.keyCode,\n\t\t\tcode: e.code,\n\t\t\tshiftKey: e.shiftKey,\n\t\t\taltKey: e.altKey,\n\t\t\tctrlKey: e.ctrlKey,\n\t\t\tmetaKey: e.metaKey,\n\t\t\trepeat: e.repeat\n\t\t});\n\t};\n\n\tconst onMessage = (message) => {\n\t\tipcRenderer.sendToHost(message.data.command, message.data.data);\n\t};\n\n\tlet isHandlingScroll = false;\n\tconst handleInnerScroll = (event) => {\n\t\tif (isHandlingScroll) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst progress = event.currentTarget.scrollY / event.target.body.clientHeight;\n\t\tif (isNaN(progress)) {\n\t\t\treturn;\n\t\t}\n\n\t\tisHandlingScroll = true;\n\t\twindow.requestAnimationFrame(() => {\n\t\t\ttry {\n\t\t\t\tipcRenderer.sendToHost('did-scroll', progress);\n\t\t\t} catch (e) {\n\t\t\t\t// noop\n\t\t\t}\n\t\t\tisHandlingScroll = false;\n\t\t});\n\t};\n\n\tdocument.addEventListener('DOMContentLoaded', () => {\n\t\tipcRenderer.on('baseUrl', (_event, value) => {\n\t\t\tinitData.baseUrl = value;\n\t\t});\n\n\t\tipcRenderer.on('styles', (_event, variables, activeTheme) => {\n\t\t\tinitData.styles = variables;\n\t\t\tinitData.activeTheme = activeTheme;\n\n\t\t\tconst target = getActiveFrame();\n\t\t\tif (!target) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tapplyStyles(target.contentDocument.body);\n\t\t});\n\n\t\t// propagate focus\n\t\tipcRenderer.on('focus', () => {\n\t\t\tconst target = getActiveFrame();\n\t\t\tif (target) {\n\t\t\t\ttarget.contentWindow.focus();\n\t\t\t}\n\t\t});\n\n\t\t// update iframe-contents\n\t\tipcRenderer.on('content', (_event, data) => {\n\t\t\tconst options = data.options;\n\n\t\t\tregisterVscodeResourceScheme();\n\n\t\t\tconst text = data.contents;\n\t\t\tconst newDocument = new DOMParser().parseFromString(text, 'text/html');\n\n\t\t\tnewDocument.querySelectorAll('a').forEach(a => {\n\t\t\t\tif (!a.title) {\n\t\t\t\t\ta.title = a.getAttribute('href');\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t// set base-url if applicable\n\t\t\tif (initData.baseUrl && newDocument.head.getElementsByTagName('base').length === 0) {\n\t\t\t\tconst baseElement = newDocument.createElement('base');\n\t\t\t\tbaseElement.href = initData.baseUrl;\n\t\t\t\tnewDocument.head.appendChild(baseElement);\n\t\t\t}\n\n\t\t\t// apply default script\n\t\t\tif (options.allowScripts) {\n\t\t\t\tconst defaultScript = newDocument.createElement('script');\n\t\t\t\tdefaultScript.textContent = `\n\t\t\t\t\tconst acquireVsCodeApi = (function() {\n\t\t\t\t\t\tconst originalPostMessage = window.parent.postMessage.bind(window.parent);\n\t\t\t\t\t\tlet acquired = false;\n\n\t\t\t\t\t\tlet state = ${data.state ? `JSON.parse(${JSON.stringify(data.state)})` : undefined};\n\n\t\t\t\t\t\treturn () => {\n\t\t\t\t\t\t\tif (acquired) {\n\t\t\t\t\t\t\t\tthrow new Error('An instance of the VS Code API has already been acquired');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tacquired = true;\n\t\t\t\t\t\t\treturn Object.freeze({\n\t\t\t\t\t\t\t\tpostMessage: function(msg) {\n\t\t\t\t\t\t\t\t\treturn originalPostMessage({ command: 'onmessage', data: msg }, '*');\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tsetState: function(newState) {\n\t\t\t\t\t\t\t\t\tstate = newState;\n\t\t\t\t\t\t\t\t\toriginalPostMessage({ command: 'do-update-state', data: JSON.stringify(newState) }, '*');\n\t\t\t\t\t\t\t\t\treturn newState;\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tgetState: function() {\n\t\t\t\t\t\t\t\t\treturn state;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t};\n\t\t\t\t\t})();\n\t\t\t\t\tdelete window.parent;\n\t\t\t\t\tdelete window.top;\n\t\t\t\t\tdelete window.frameElement;\n\t\t\t\t`;\n\n\t\t\t\tnewDocument.head.prepend(defaultScript);\n\t\t\t}\n\n\t\t\t// apply default styles\n\t\t\tconst defaultStyles = newDocument.createElement('style');\n\t\t\tdefaultStyles.id = '_defaultStyles';\n\t\t\tdefaultStyles.innerHTML = getDefaultCss(initData.styles);\n\t\t\tnewDocument.head.prepend(defaultStyles);\n\n\t\t\tapplyStyles(newDocument.body);\n\n\t\t\tconst frame = getActiveFrame();\n\t\t\tconst wasFirstLoad = firstLoad;\n\t\t\t// keep current scrollY around and use later\n\t\t\tlet setInitialScrollPosition;\n\t\t\tif (firstLoad) {\n\t\t\t\tfirstLoad = false;\n\t\t\t\tsetInitialScrollPosition = (body, window) => {\n\t\t\t\t\tif (!isNaN(initData.initialScrollProgress)) {\n\t\t\t\t\t\tif (window.scrollY === 0) {\n\t\t\t\t\t\t\twindow.scroll(0, body.clientHeight * initData.initialScrollProgress);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t} else {\n\t\t\t\tconst scrollY = frame && frame.contentDocument && frame.contentDocument.body ? frame.contentWindow.scrollY : 0;\n\t\t\t\tsetInitialScrollPosition = (body, window) => {\n\t\t\t\t\tif (window.scrollY === 0) {\n\t\t\t\t\t\twindow.scroll(0, scrollY);\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t}\n\n\t\t\t// Clean up old pending frames and set current one as new one\n\t\t\tconst previousPendingFrame = getPendingFrame();\n\t\t\tif (previousPendingFrame) {\n\t\t\t\tpreviousPendingFrame.setAttribute('id', '');\n\t\t\t\tdocument.body.removeChild(previousPendingFrame);\n\t\t\t}\n\t\t\tif (!wasFirstLoad) {\n\t\t\t\tpendingMessages = [];\n\t\t\t}\n\n\t\t\tconst newFrame = document.createElement('iframe');\n\t\t\tnewFrame.setAttribute('id', 'pending-frame');\n\t\t\tnewFrame.setAttribute('frameborder', '0');\n\t\t\tnewFrame.setAttribute('sandbox', options.allowScripts ? 'allow-scripts allow-forms allow-same-origin' : 'allow-same-origin');\n\t\t\tnewFrame.style.cssText = 'display: block; margin: 0; overflow: hidden; position: absolute; width: 100%; height: 100%; visibility: hidden';\n\t\t\tdocument.body.appendChild(newFrame);\n\n\t\t\t// write new content onto iframe\n\t\t\tnewFrame.contentDocument.open('text/html', 'replace');\n\t\t\tnewFrame.contentWindow.addEventListener('keydown', handleInnerKeydown);\n\t\t\tnewFrame.contentWindow.onbeforeunload = () => {\n\t\t\t\tif (isInDevelopmentMode) { // Allow reloads while developing a webview\n\t\t\t\t\tipcRenderer.sendToHost('do-reload');\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\t// Block navigation when not in development mode\n\t\t\t\tconsole.log('prevented webview navigation');\n\t\t\t\treturn false;\n\t\t\t};\n\n\t\t\tlet onLoad = (contentDocument, contentWindow) => {\n\t\t\t\tif (contentDocument.body) {\n\t\t\t\t\t// Workaround for https://github.com/Microsoft/vscode/issues/12865\n\t\t\t\t\t// check new scrollY and reset if neccessary\n\t\t\t\t\tsetInitialScrollPosition(contentDocument.body, contentWindow);\n\t\t\t\t}\n\n\t\t\t\tconst newFrame = getPendingFrame();\n\t\t\t\tif (newFrame && newFrame.contentDocument === contentDocument) {\n\t\t\t\t\tconst oldActiveFrame = getActiveFrame();\n\t\t\t\t\tif (oldActiveFrame) {\n\t\t\t\t\t\tdocument.body.removeChild(oldActiveFrame);\n\t\t\t\t\t}\n\t\t\t\t\t// Styles may have changed since we created the element. Make sure we re-style\n\t\t\t\t\tapplyStyles(newFrame.contentDocument.body);\n\t\t\t\t\tnewFrame.setAttribute('id', 'active-frame');\n\t\t\t\t\tnewFrame.style.visibility = 'visible';\n\t\t\t\t\tnewFrame.contentWindow.focus();\n\n\t\t\t\t\tcontentWindow.addEventListener('scroll', handleInnerScroll);\n\n\t\t\t\t\tpendingMessages.forEach((data) => {\n\t\t\t\t\t\tcontentWindow.postMessage(data, '*');\n\t\t\t\t\t});\n\t\t\t\t\tpendingMessages = [];\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tclearTimeout(loadTimeout);\n\t\t\tloadTimeout = undefined;\n\t\t\tloadTimeout = setTimeout(() => {\n\t\t\t\tclearTimeout(loadTimeout);\n\t\t\t\tloadTimeout = undefined;\n\t\t\t\tonLoad(newFrame.contentDocument, newFrame.contentWindow);\n\t\t\t}, 200);\n\n\t\t\tnewFrame.contentWindow.addEventListener('load', function (e) {\n\t\t\t\tif (loadTimeout) {\n\t\t\t\t\tclearTimeout(loadTimeout);\n\t\t\t\t\tloadTimeout = undefined;\n\t\t\t\t\tonLoad(e.target, this);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t// Bubble out link clicks\n\t\t\tnewFrame.contentWindow.addEventListener('click', handleInnerClick);\n\n\t\t\t// set DOCTYPE for newDocument explicitly as DOMParser.parseFromString strips it off\n\t\t\t// and DOCTYPE is needed in the iframe to ensure that the user agent stylesheet is correctly overridden\n\t\t\tnewFrame.contentDocument.write('<!DOCTYPE html>');\n\t\t\tnewFrame.contentDocument.write(newDocument.documentElement.innerHTML);\n\t\t\tnewFrame.contentDocument.close();\n\n\t\t\tipcRenderer.sendToHost('did-set-content');\n\t\t});\n\n\t\t// Forward message to the embedded iframe\n\t\tipcRenderer.on('message', (_event, data) => {\n\t\t\tconst pending = getPendingFrame();\n\t\t\tif (!pending) {\n\t\t\t\tconst target = getActiveFrame();\n\t\t\t\tif (target) {\n\t\t\t\t\ttarget.contentWindow.postMessage(data, '*');\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\t\t\tpendingMessages.push(data);\n\t\t});\n\n\t\tipcRenderer.on('initial-scroll-position', (_event, progress) => {\n\t\t\tinitData.initialScrollProgress = progress;\n\t\t});\n\n\t\tipcRenderer.on('devtools-opened', () => {\n\t\t\tisInDevelopmentMode = true;\n\t\t});\n\n\t\ttrackFocus({\n\t\t\tonFocus: () => { ipcRenderer.sendToHost('did-focus'); },\n\t\t\tonBlur: () => { ipcRenderer.sendToHost('did-blur'); }\n\t\t});\n\n\t\t// Forward messages from the embedded iframe\n\t\twindow.onmessage = onMessage;\n\n\t\t// signal ready\n\t\tipcRenderer.sendToHost('webview-ready', process.pid);\n\t});\n\n\t/**\n\t * @param {{ [variable: string]: string }} styles\n\t */\n\tfunction getDefaultCss(styles) {\n\t\tconst vars = Object.keys(styles || {}).map(variable => {\n\t\t\treturn `--${variable}: ${styles[variable].replace(/[^#\"',. a-z0-9\\-()]/gi, '')};`;\n\t\t});\n\t\treturn `\n\t\t\t:root { ${vars.join('\\n')} }\n\t\t\t${defaultCssRules}\n\t\t`;\n\t}\n\n\tconst defaultCssRules = `\n\t\tbody {\n\t\t\tbackground-color: var(--vscode-editor-background);\n\t\t\tcolor: var(--vscode-editor-foreground);\n\t\t\tfont-family: var(--vscode-editor-font-family);\n\t\t\tfont-weight: var(--vscode-editor-font-weight);\n\t\t\tfont-size: var(--vscode-editor-font-size);\n\t\t\tmargin: 0;\n\t\t\tpadding: 0 20px;\n\t\t}\n\n\t\timg {\n\t\t\tmax-width: 100%;\n\t\t\tmax-height: 100%;\n\t\t}\n\n\t\ta {\n\t\t\tcolor: var(--vscode-textLink-foreground);\n\t\t}\n\n\t\ta:hover {\n\t\t\tcolor: var(--vscode-textLink-activeForeground);\n\t\t}\n\n\t\ta:focus,\n\t\tinput:focus,\n\t\tselect:focus,\n\t\ttextarea:focus {\n\t\t\toutline: 1px solid -webkit-focus-ring-color;\n\t\t\toutline-offset: -1px;\n\t\t}\n\n\t\tcode {\n\t\t\tcolor: var(--vscode-textPreformat-foreground);\n\t\t}\n\n\t\tblockquote {\n\t\t\tbackground: var(--vscode-textBlockQuote-background);\n\t\t\tborder-color: var(--vscode-textBlockQuote-border);\n\t\t}\n\n\t\t::-webkit-scrollbar {\n\t\t\twidth: 10px;\n\t\t\theight: 10px;\n\t\t}\n\n\t\t::-webkit-scrollbar-thumb {\n\t\t\tbackground-color: var(--vscode-scrollbarSlider-background);\n\t\t}\n\t\t::-webkit-scrollbar-thumb:hover {\n\t\t\tbackground-color: var(--vscode-scrollbarSlider-hoverBackground);\n\t\t}\n\t\t::-webkit-scrollbar-thumb:active {\n\t\t\tbackground-color: var(--vscode-scrollbarSlider-activeBackground);\n\t\t}`;\n}());"]}